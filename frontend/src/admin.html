<!doctype html>
<html>
<head>
  <meta charset="utf-8">
  <title>Admin · Gijón Club</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <style>
    body{padding:20px;background:#fbfbff}
    .card{border-radius:12px}
    .brand{font-family: 'Segoe UI', Roboto, sans-serif;color:#6b21a8}
  </style>
</head>
<body>
<div class="container">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h1 class="brand">Gijón Club · Admin</h1>
    <div>
      <a class="btn btn-sm btn-outline-secondary" href="/">Ver sitio</a>
    </div>
  </div>

  <div class="card p-4 mb-4">
    <h4>Iniciar sesión</h4>
    <form id="login" class="row g-2">
      <div class="col-md-4"><input id="email" class="form-control" value="admin@gijonclub.local"/></div>
      <div class="col-md-4"><input id="password" class="form-control" value="AdminPass123!"/></div>
      <div class="col-md-2"><button class="btn btn-primary w-100">Entrar</button></div>
    </form>
  </div>

  <div id="dashboard" style="display:none">
    <div class="row mb-4">
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Ventas por zona</h5>
          <canvas id="salesChart" height="140"></canvas>
        </div>
      </div>
      <div class="col-md-6">
        <div class="card p-3">
          <h5>Estadísticas</h5>
          <pre id="stats"></pre>
        </div>
      </div>
    </div>

    <div class="card p-3">
      <h5>Crear RRPP</h5>
      <form id="rrpp" class="row g-2">
        <div class="col-md-4"><input id="rrpp_email" class="form-control" placeholder="email rrpp"/></div>
        <div class="col-md-4"><input id="rrpp_name" class="form-control" placeholder="nombre rrpp"/></div>
        <div class="col-md-2"><button class="btn btn-success w-100">Crear</button></div>
      </form>
    </div>
  </div>
</div>
<script>
const apiBase='/api';
let salesChart=null;
document.getElementById('login').addEventListener('submit', async e=>{
  e.preventDefault();
  const email=document.getElementById('email').value;
  const password=document.getElementById('password').value;
  const res=await fetch(apiBase+'/login',{method:'POST',headers:{'Content-Type':'application/json'},body:JSON.stringify({email,password})});
  const j=await res.json();
  if(j.status==='ok'){ localStorage.setItem('token', j.token); document.getElementById('dashboard').style.display='block'; loadStats(); }
  else alert('login failed');
});

async function loadStats(){
  const token = localStorage.getItem('token');
  const res = await fetch(apiBase+'/stats',{method:'GET',headers:{'Authorization':'Bearer '+token}});
  const j = await res.json();
  if(j.status!=='ok'){ alert('no stats'); return; }
  document.getElementById('stats').textContent = JSON.stringify(j.stats, null, 2);
  // build chart
  const zones = j.stats.zones || {};
  const labels = Object.keys(zones);
  const data = Object.values(zones);
  const ctx = document.getElementById('salesChart').getContext('2d');
  if(salesChart) salesChart.destroy();
  salesChart = new Chart(ctx, {
    type:'bar',
    data:{labels:labels, datasets:[{label:'Entradas vendidas', data:data}]},
    options:{responsive:true}
  });
}

document.getElementById('rrpp').addEventListener('submit', async e=>{
  e.preventDefault();
  const token=localStorage.getItem('token');
  const email=document.getElementById('rrpp_email').value; const name=document.getElementById('rrpp_name').value;
  const res = await fetch(apiBase+'/rrpp',{method:'POST',headers:{'Content-Type':'application/json','Authorization':'Bearer '+token},body:JSON.stringify({email,name,password:'RrppPass123!'})});
  const j = await res.json();
  alert(JSON.stringify(j));
});
</script>
</body>
</html>
